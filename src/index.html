<!DOCTYPE html>
<html>

<head>
    <style>
        body {
            background-color: #000;
            color: #0F0;
            font-family: monospace;
        }

        #outer-div {
            white-space: pre;
            overflow-wrap: normal;
            width: 100%;
            height: 100vh;
        }

        #cursor {
            animation: blink 1s step-end infinite;
        }


        @keyframes blink {

            from,
            to {
                color: transparent
            }

            50% {
                color: #0F0;
            }
        }
    </style>
</head>

<body>
    <div id="outer-div" onclick="focusMethod()"><div id="terminal"></div></div>
    <script>
        var terminal = document.getElementById('terminal');

        createMOTD();
        buildFirstLine();

        var line = document.getElementById('line');
        var input = document.getElementById('input');
        var cursor = document.getElementById('cursor');
        var pwd = '/home/user'
        var approvedCommands = {
            'ls': '',
            'pwd': '',
            'whoami': 'user',
            'clear': '',
            'motd': '',
            'help': 'Available Commands',
            'cd': '',
            'cat': '',
            'ls -al': 'ls -al',
            'll': 'll',
            '': '',
        };
        var directoryListings = {
            '/': ['home', 'usr', 'var', 'opt', 'lib', 'tmp'],
            '/home': ['user', 'bryan'],
            '/home/user': ['experience.yml', 'projects.yml', 'about-me.yml'],
            '/home/bryan': ['experience.yml', 'projects.yml', 'about-me.yml'],
            '/usr': ['local', 'bin'],
            '/usr/local': [],
            '/usr/bin': ['kubectl', 'cat', 'cd', 'motd', 'clear', 'ls', 'pwd'],
            '/var': [],
            '/opt': [],
            '/lib': [],
            '/tmp': [],
        }

        function processCommand(input) {
            var splitString = 'user@bryan-crow.com:~$ ';
            var returnString = '';
            result = splitInput(input, splitString)
            if (result == 'clear') {
                removeChildrenWithId(terminal)
            } else if (result.startsWith('resume')){
                handleResumeCommand(result);
            } else if (result == 'motd') {
                createMOTD();
            } else if (result.startsWith('cd')) {
                returnString = handleCd(result);
                returnString += '\n';
            } else if (result.startsWith('cat')) {
                returnString = handleCatInput(result);
                returnString += '\n';
            } else if (result.startsWith('ls')) {
                returnString = 'experience.yml  projects.yml  about-me.yml file2.txt  directory1  directory2' + '\n';
            } else if (result.startsWith('pwd')){
                returnString = pwd + '\n';
            } else {
                returnString = approvedCommands[result] || 'command not found';
                returnString += '\n';
            }
            return returnString;
        }

        function handleCd(inputString) {
            return 'changing dir';
        }

        function handleCatInput(inputString) {
            return 'You certainly tried to cat something.';
        }

        function splitInput(inputString, splitString) {
            if (inputString.includes(splitString)) {
                return inputString.split(splitString)[1];
            } else {
                return "The specified string is not found in the input.";
            }
        }

        function removeChildrenWithId(element) {
            var children = element.childNodes;
            for (var i = 0; i < children.length; i++) {
                if (children[i].id === 'line') {
                    element.removeChild(children[i]);
                    i--; // Adjust counter as childNodes is a live collection
                }
            }
        }

        function createMOTD() {
            var motdLines = ['Welcome to Bryan Crow Resume 1.0.0 LTS',
            '  ',
            '|site|* LinkedIn ~https://www.linkedin.com/in/bryan-crow/',
            '|site|* GitHub ~https://github.com/cryanbrow',
            '  ',
            'This is an interactive resume. To get started, enter help to get available commands',
            'or enter experience, about, or projects to get started.',
            '  ',
            'All files supporting this are in the pwd, use ls and cat to read files directly.',
            '  ']
            for (var i = 0; i < motdLines.length; i++) {
                if (motdLines[i].startsWith('|site|')) {
                    result = splitInput(motdLines[i], '|site|')

                    urlComponents = result.split('~');

                    line = document.createElement('div');
                    line.id = 'line';
                    urlLabelSpan = document.createElement('span');
                    urlLabelSpan.id = 'urlLabelSpan' + i;
                    urlLabelSpan.textContent = urlComponents[0];
                    urlHref = document.createElement('a');
                    urlHref.id = 'href' + i;
                    urlHref.setAttribute('href', urlComponents[1]);
                    urlHref.setAttribute('target', '_blank');
                    urlHref.textContent = urlComponents[1];
                    line.appendChild(urlLabelSpan);
                    line.appendChild(urlHref);
                    terminal.appendChild(line);
                } else {
                    line = document.createElement('div');
                    line.id = 'line';
                    motdSpan = document.createElement('span');
                    motdSpan.id = 'motd' + i;
                    motdSpan.textContent = motdLines[i];
                    line.appendChild(motdSpan);
                    terminal.appendChild(line);
                }
            }
        }

        function buildFirstLine() {
            line = document.createElement('div');
            line.id = 'line';
            inputSpan = document.createElement('span');
            inputSpan.id = 'input';
            inputSpan.textContent = 'user@bryan-crow.com:~$ '
            cursorSpan = document.createElement('span');
            cursorSpan.id = 'cursor';
            cursorSpan.textContent = '_';
            line.appendChild(inputSpan);
            line.appendChild(cursorSpan);
            terminal.appendChild(line);
        }

        window.addEventListener('keydown', function (e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                var output = processCommand(input.textContent);
                cursor.remove();
                //terminal.innerHTML += output;
                line = document.createElement('div');
                line.id = 'line';
                line.textContent = output;
                terminal.appendChild(line);
                input = document.createElement('span');
                input.id = 'input';
                input.textContent = 'user@bryan-crow.com:~$ ';
                line.appendChild(input);
                cursor = document.createElement('span');
                cursor.id = 'cursor';
                cursor.textContent = '_';
                line.appendChild(cursor);
            } else if (e.key.length === 1) {
                input.textContent += e.key;
            } else if (e.key === 'Backspace') {
                e.preventDefault();
                input.textContent = input.textContent.slice(0, -1);
            }
        });

        function isMobileDevice() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        };

        if( isMobileDevice() ) {
            console.log("You are using a mobile device");
        } else {
            console.log("You are not using a mobile device");
        }

        function handleResumeCommand(command) {
            var returnString = '';
            if (result.startsWith('resume')){
                var resumeCommand = command.replace('resume', '').trim();
                if (resumeCommand) {
                    switch (true) {
                        case resumeCommand.includes("--"):
                            returnString += 'found --';
                            break;
                        default:
                            returnString += 'invalid resume command';
                    }
                } else {
                    returnString += "everything resume"
                }
            }
            return returnString;
        }

    </script>
</body>

</html>